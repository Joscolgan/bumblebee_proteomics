## Create data directory:
mkdir data
cd data

## Copy downloaded file from Ensembl metazoa to current directory:
cp -p ~/Downloads/mart_export.txt .
## Rename file with a symbolic link:
ln -s mart_export.txt dn_ds_bter_amel_raw.txt
cd ../

## Create results directory
mkdir results
cd results

## Create symbolic link:
ln -s ../data/dn_ds_bter_amel_raw.txt .
cut -f1,2,3,4,5,6,7,8 dn_ds_bter_amel_raw.txt > dn_ds_bter_amel_raw.tmp

## Filter out genes that are single copies between Bombus and Apis:
cut -f 1,3,4,5 dn_ds_bter_amel_raw.tmp | \
 sort -k1,1nr | uniq -c | awk '$1==1' - | \
 awk '{ print $2, $3,$4,$5 }' | tr ' ' '\t' | \
 grep -v 'stable' > putative_single_copies.tmp

## Extract potential single copies in Apis mellifera:
cut -f 4 putative_single_copies.tmp| sort | \
uniq -c | awk '$1==1' | \
awk '{ print $2 }' > putative_single_copies_apis.tmp

##Â Parse these genes so that only one copy of bombus and copy copy of
## apis should remain:
grep -f putative_single_copies_apis.tmp putative_single_copies.tmp > putative_single_copies.txt

## Calculate Dn/Ds
awk '$5=$2/$3' putative_single_copies.txt | tr ' ' '\t' | sort -k5,5nr
