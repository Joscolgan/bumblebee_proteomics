---
title: "haemolymph_line_graphs"
author: "JoeColgan"
date: "11 September 2018"
output: html_document
---

The purpose of this script is to take label-free quantitative (LFQ) values as input and generate line graphs for biological groups of interest, namely:
1) Muscle-related genes
2) Olfactory-related genes

```{r}
## Load libraries:
libraries <- c("lintr", "ggplot2", "ggpubr", "reshape", "Rmisc")
for (lib in libraries) {
        if (require(package = lib, character.only = TRUE)) {
                print("Successful")
        } else {
                print("Installing")
                source("https://bioconductor.org/biocLite.R")
                biocLite(pkgs = lib)
                library(lib, character.only = TRUE )
        }
}
```

Load in data:

```{r, echo=FALSE}
## Read in data and store as a variable:
lfq_values <- read.csv(file = "~/Downloads/All Diapause Hits_for PCA_GOs.csv", header = TRUE)

## Subset:
lfq_values_subset <- lfq_values[,1:25]
rownames(lfq_values_subset) <- lfq_values_subset$Protein.ID
lfq_values_subset$Protein.ID <- NULL

## Need to be able to subset genes of interest:
muscle_proteins <- read.table(file = "~/Documents/2017-03-25_diapause_proteomics/input_for_line_plots/muscle_proteins.txt", header = FALSE)

## Update column names:
colnames(muscle_proteins) <- c("protein_id", "protein_description")

lfq_values_subset_muscle <- lfq_values_subset[which(row.names(lfq_values_subset) %in% muscle_proteins$protein_id), ]

## Subset protein names:
colnames(lfq_values_subset_muscle) <- c(rep("gyne", 4), rep("prediapause", 4), rep("early_diapause", 4),
           rep("late diapause", 4), rep("6_hrs_postdiapause", 4), rep("48_hours_postdiapause", 4))

## Reshape:
lfq_values_subset_muscle_melt <- melt(t(lfq_values_subset_muscle))

## Update column names:
colnames(lfq_values_subset_muscle_melt) <- c("stage", "protein_id", "LFQ")

## Plot line plot:
lfq_values_subset_muscle_melt <- droplevels(lfq_values_subset_muscle_melt)

lfq_values_subset_muscle_melt$stage <- factor(lfq_values_subset_muscle_melt$stage, levels = c("gyne", "prediapause", "early_diapause", "late diapause", "6_hrs_postdiapause", "48_hours_postdiapause"))

## Summarise LFQ values to get standard deviation, standard error of the mean and a default (95%) confidence interval:      
lfq_values_subset_muscle_melt_melt_SE <- summarySE(lfq_values_subset_muscle_melt, 
                                                 measurevar="LFQ", 
                                                 groupvars=c("stage", "protein_id"))

```

Generate line graphs:

```{r}
pd <- position_dodge(0.1) # move them .05 to the left and right

## Define title:
plot_title_muscle <- "Muscle/structural-associated haemolymph proteins"

## Generate plot:
muscle_plot <- ggplot(lfq_values_subset_muscle_melt_melt_SE, aes(x=stage, y=LFQ, colour=protein_id, group=protein_id)) + 
    geom_errorbar(aes(ymin=LFQ-se, ymax=LFQ+se), colour="black", width=.1, position=pd) +
    geom_line(position=pd) +
    geom_point(position=pd, size=3, shape=21, fill="white") + # 21 is filled circle
    #xlab("Queen life cycle stages") +
    ylab("LFQ values") +
    #scale_colour_hue(name="Supplement type",    # Legend label, use darker colors
    #                 breaks=c("OJ", "VC"),
    #                 labels=c("Orange juice", "Ascorbic acid"),
    #                 l=40) +                    # Use darker colors, lightness=40
    ggtitle(plot_title_muscle) +
    #expand_limits(y=0) +                        # Expand y range
    scale_y_continuous(breaks=0:20*2) +         # Set tick every 4
    theme_bw() +
        theme(legend.position = "bottom",
              axis.title.x = element_blank(),
              axis.text.x = element_text(angle = 45, hjust = 1),
              #axis.text.y = element_text(face="bold"),
              axis.title.y = element_text(face = "bold", size = 10))
    #theme(legend.justification=c(1,0),
          #legend.position=c(1,0))               # Position legend in bottom right


```

```{r}
## Read in file:
olfaction_proteins <- read.table(file = "~/Documents/2017-03-25_diapause_proteomics/input_for_line_plots/olfaction_proteins.txt", header = FALSE)

## Update column names:
colnames(olfaction_proteins) <- c("protein_id", "protein_description")

lfq_values_subset_olfaction <- lfq_values_subset[which(row.names(lfq_values_subset) %in% olfaction_proteins$protein_id), ]

## Subset protein names:
colnames(lfq_values_subset_olfaction) <- c(rep("gyne", 4), rep("prediapause", 4), rep("early diapause", 4),
           rep("late diapause", 4), rep("6 hrs postdiapause", 4), rep("48 hours postdiapause", 4))

## Reshape:
lfq_values_subset_olfaction_melt <- melt(t(lfq_values_subset_olfaction))

## Update column names:
colnames(lfq_values_subset_olfaction_melt) <- c("stage", "protein_id", "LFQ")

## Plot line plot:
lfq_values_subset_olfaction_melt <- droplevels(lfq_values_subset_olfaction_melt)

lfq_values_subset_olfaction_melt$stage <- factor(lfq_values_subset_olfaction_melt$stage, levels = c("gyne", "prediapause", "early diapause", "late diapause", "6 hrs postdiapause", "48 hours postdiapause"))

## Summarise LFQ values to get standard deviation, standard error of the mean and a default (95%) confidence interval:      
lfq_values_subset_olfaction_melt_SE <- summarySE(lfq_values_subset_olfaction_melt, 
                                                 measurevar="LFQ", 
                                                 groupvars=c("stage", "protein_id"))


## Insert value to adjust points:
pd <- position_dodge(0.1) # move them .05 to the left and right

## Define title:
plot_title_olfaction <- "Olfaction-associated haemolymph proteins"

## Generate plot:
olfaction_plot <- ggplot(lfq_values_subset_olfaction_melt_SE, aes(x=stage, y=LFQ, colour=protein_id, group=protein_id)) + 
    geom_errorbar(aes(ymin=LFQ-se, ymax=LFQ+se), colour="black", width=.1, position=pd) +
    geom_line(position=pd) +
    geom_point(position=pd, size=3, shape=21, fill="white") + # 21 is filled circle
    #xlab("Queen life cycle stages") +
    ylab("LFQ values") +
    #scale_colour_hue(name="Supplement type",    # Legend label, use darker colors
    #                 breaks=c("OJ", "VC"),
    #                 labels=c("Orange juice", "Ascorbic acid"),
    #                 l=40) +                    # Use darker colors, lightness=40
    ggtitle(plot_title_olfaction) +
    #expand_limits(y=0) +                        # Expand y range
    scale_y_continuous(breaks=0:20*2) +         # Set tick every 4
    theme_bw() +
        theme(legend.position = "bottom",
              axis.title.x = element_blank(),
              axis.text.x = element_text(angle = 45, hjust = 1),
              #axis.text.y = element_text(face="bold"),
              axis.title.y = element_text(face = "bold", size = 10))
    #theme(legend.justification=c(1,0),
          #legend.position=c(1,0))               # Position legend in bottom right
```

Combine figures for plotting:

```{r}
## Combine figures for plotting:
ggarrange(olfaction_plot, muscle_plot,
          nrow =2, ncol=1)

## output and save combined figure:
ggsave("combined_figure.png", height = 20, width = 18)

```
