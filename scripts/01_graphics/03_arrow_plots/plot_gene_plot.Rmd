--- 
title: "Bombus haemolymph diapause study"
output: plot_gene_arrowplot.html
authors:  Joe Colgan (joscolgan)
--- 

## Introduction 
This script takes gene coordinates and generates an arrow-plot using [gggenes](https://cran.r-project.org/web/packages/gggenes/vignettes/introduction-to-gggenes.html).  
This script outputs a image saved in .png file format.  

This script takes a tab-delimited file as input containing the following columns:
1) Chromosome name
2) Start position of chromosome
3) End position of chromosome
4) Gene name
5) Strand
6) Status - if you want to highlight a gene of interest

```{r, message = FALSE}
# Load libraries; install from scratch if needed
libraries <- c("gggenes",
               "ggplot2",
               "lintr",
               "ggpubr")
for (lib in libraries) {
    if (require(package = lib, character.only = TRUE)) {
        print("Successful")
    } else {
        print("Installing")
        source("https://bioconductor.org/biocLite.R")
        biocLite(pkgs = lib)
        library(lib, character.only = TRUE )
    }
}
```

Read in data:

```{r, message = FALSE}
## Read in file for plotting:
data <- read.table(file = "./data/input_for_gggenes.txt",
                   header = TRUE)
```

Generate plot:

```{r, message = FALSE}
## Set directions:
## This codes forward and reverse strands as '1' and '-1', 
## which results in the strands being produced for the plot.
data$direction <- ifelse(data$strand == "forward", 1, -1)

## Plot colour by gene:
arrow_plot_by_gene <- ggplot(
        subset(data, molecule == "NC_015762.1"),
        aes(xmin = start,
            xmax = end,
            y = strand,
            fill = gene,
            label = gene,
            forward = direction)) +
        ylab("Chromosome 1") +
        geom_gene_arrow(arrowhead_width = grid::unit(10, "mm"),
                        arrowhead_height = grid::unit(10, "mm"),
                        arrow_body_height = grid::unit(8, "mm")) +
        geom_gene_label(align = "left", min.size = 6) +
        facet_wrap(~ molecule, scales = "free", nrow = 1, shrink = TRUE) +
        scale_fill_brewer(palette = "Blues") +
        theme_genes()
        
## Print to console:
arrow_plot_by_gene

## Plot colour by status:
arrow_plot_by_group <- ggplot(
        subset(data, molecule == "NC_015762.1"),
        aes(xmin = start,
            xmax = end,
            y = strand,
            fill = status,
            label = gene,
            forward = direction)) +
        xlab("Chromosome coordinates") +
        ylab("Chromosome 1") +
        geom_gene_arrow(arrowhead_width = grid::unit(10, "mm"),
                        arrowhead_height = grid::unit(10, "mm"),
                        arrow_body_height = grid::unit(8, "mm")) +
        geom_gene_label(align = "left", min.size = 6) +
        facet_wrap(~ molecule,
                   scales = "free",
                   nrow = 1,
                   shrink = FALSE) +
        scale_fill_brewer(palette = "Reds") +
        theme_genes()

## print to console:
arrow_plot_by_group

## Combine plot:
ggarrange(arrow_plot_by_gene,
          arrow_plot_by_group,
          nrow = 2,
          align = "v")

## Save output:
ggsave(file = "results/hahp_arrowplot.png",
       height = 10,
       width = 20)
```

Run lintr

```{r, message = FALSE}
lintr::lint(file = "./plot_gene_plot.Rmd")
```

